<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">stores/ObjectsStore.js | ETS API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
<script data-ice="userScript" src="user/script/0-script.js"></script>
<link data-ice="userStyle" rel="stylesheet" href="user/css/0-style.css">
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/DashboardStore.js~DashboardStore.html">DashboardStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/EmployeesStore.js~EmployeeStore.html">EmployeeStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/FuelRatesStore.js~FuelRatesStore.html">FuelRatesStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/GeoObjectsStore.js~GeoObjectsStore.html">GeoObjectsStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/MissionsStore.js~MissionsStore.html">MissionsStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/NotificationsStore.js~NotificationsStore.html">NotificationsStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/ObjectsStore.js~ObjectsStore.html">ObjectsStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/ReportsStore.js~ReportsStore.html">ReportsStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/RoutesStore.js~RoutesStore.html">RoutesStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/SettingsStore.js~SettingsStore.html">SettingsStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/stores/WaybillsStore.js~WaybillsStore.html">WaybillsStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultDutyMission">getDefaultDutyMission</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultDutyMissionTemplate">getDefaultDutyMissionTemplate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultDutyMissionsCreationTemplate">getDefaultDutyMissionsCreationTemplate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultMission">getDefaultMission</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultMissionTemplate">getDefaultMissionTemplate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultMissionsCreationTemplate">getDefaultMissionsCreationTemplate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDefaultBill">getDefaultBill</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">stores/ObjectsStore.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { Store } from &apos;flummox&apos;;
import _ from &apos;lodash&apos;;

class ObjectsStore extends Store {

  constructor(flux) {
    super();

    const objectsActions = flux.getActions(&apos;objects&apos;);
    const carActions = flux.getActions(&apos;cars&apos;);
    const technicalOperationsActions = flux.getActions(&apos;technicalOperation&apos;);
    const companyStructreActions = flux.getActions(&apos;companyStructure&apos;);

    this.register(carActions.updateCarAdditionalInfo, this.handleGetCars);

    this.register(objectsActions.getCars, this.handleGetCars);
    this.register(objectsActions.getModels, this.handleGetModels);
    this.register(objectsActions.getSpecialModels, this.handleGetSpecialModels);
    this.register(objectsActions.getTypes, this.handleGetTypes);
    this.register(objectsActions.getCustomers, this.handleGetCustomers);
    this.register(objectsActions.getOwners, this.handleGetOwners);
    this.register(objectsActions.getFuelTypes, this.handleGetFuelTypes);
    this.register(objectsActions.getWorkKinds, this.handleGetWorkKinds);
    this.register(objectsActions.getOrganizations, this.handleGetOrganizations);
    this.register(objectsActions.getFaxogramms, this.handleGetFaxogramms);
    this.register(objectsActions.getPositions, this.handleGetPositions);

    this.register(companyStructreActions.getCompanyStructure, this.handleGetCompanyStructure);
    this.register(companyStructreActions.getCompanyList, this.handleGetCompanyList);
    this.register(companyStructreActions.updateCompanyElement, this.handleGetCompanyStructure);
    this.register(companyStructreActions.deleteCompanyElement, this.handleGetCompanyStructure);
    this.register(companyStructreActions.createCompanyElement, this.handleGetCompanyStructure);

    this.register(technicalOperationsActions.getTechnicalOperations, this.handleGetTechOperations);
    this.register(technicalOperationsActions.updateTechnicalOperation, this.handleGetTechOperations);
    this.register(technicalOperationsActions.getTechnicalOperationsObjects, this.handleGetTechnicalOperationsObjects);
    this.register(technicalOperationsActions.getTechnicalOperationsTypes, this.handleGetTechnicalOperationsTypes);


    this.state = {
      carsList: [],
      customersList: [],
      typesList: [],
      modelsList: [],
      specialModelsList: [],
      ownersList: [],
      fuelTypes: [],
      technicalOperationsList: [],
      workKindsList: [],
      faxogrammsList: [],
      technicalOperationsObjectsList: [],
      technicalOperationsTypesList: [],
      companyStructureList: [],
      positionsList: [],
      organizations: [],

      carsIndex: {},
      modelsIndex: {},
      typesIndex: {},
      ownersIndex: {},
      technicalOperationsObjectsIndex: {},

      faxogrammsMaxPage: 0,
    };

  }

  handleGetTechnicalOperationsObjects(technicalOperationsObjects) {
    let result = technicalOperationsObjects.result;
    _.each(result, obj =&gt; {
      if (obj.short_name === &apos;&#x41E;&#x414;&#x425;&apos;) {
        obj.type = &apos;simple&apos;;
      } else if (obj.short_name === &apos;&#x414;&#x422;&apos;) {
        obj.type = &apos;simple_dt&apos;;
      } else if (obj.short_name === &apos;&#x41F;&#x41D;&apos;) {
        obj.type = &apos;points&apos;;
      }
    });
    this.setState({technicalOperationsObjectsList: result});
  }

  handleGetTechnicalOperationsTypes(technicalOperationsTypes) {
    this.setState({technicalOperationsTypesList: technicalOperationsTypes.result});
  }

  handleGetCompanyStructure(companyStructure) {
    this.setState({companyStructureList: companyStructure.result})
  }

  handleGetCompanyList(companyList) {
    this.setState({companyList: companyList.result})
  }

  handleGetCars(cars) {
    const carsList = cars.result.map( c =&gt; {
      let model = _.find(this.state.modelsList, m =&gt; m.id === c.model_id);
          c.model = model ? model.title : &apos;&#x41D;/&#x414;&apos;;
      let type = _.find(this.state.typesList, t =&gt; t.id === c.type_id);
          c.type = type ? type.title : &apos;&#x41D;/&#x414;&apos;;
      return c;
    });
    let carsIndex = _.keyBy(carsList, &apos;asuods_id&apos;);
    this.setState({carsList, carsIndex});
  }

  handleGetModels(modelsList) {
    let modelsIndex = _.keyBy(modelsList, &apos;id&apos;);
    const carsList = this.state.carsList.map( c =&gt; {
      let model = _.find(modelsList, m =&gt; m.id === c.model_id);
          c.model = model ? model.title : &apos;&#x41D;/&#x414;&apos;;
      return c;
    });
    let carsIndex = _.keyBy(carsList, &apos;asuods_id&apos;);
    this.setState({modelsList, modelsIndex});
  }

  handleGetSpecialModels({result}) {
    this.setState({specialModelsList: result});
  }

  handleGetTypes(typesList) {
    let typesIndex = _.keyBy(typesList, &apos;id&apos;);
    this.setState({typesList, typesIndex});
  }

  handleGetOwners(ownersList) {
    let ownersIndex = _.keyBy(ownersList, &apos;id&apos;);
    this.setState({ownersList, ownersIndex});
  }

  handleGetCustomers(customersList) {
    this.setState({customersList});
  }

  handleGetFuelTypes(fuelTypes) {
    this.setState({fuelTypes: fuelTypes.result});
  }

  handleGetTechOperations(techOperations) {
    this.setState({technicalOperationsList: techOperations.result});
  }

  handleGetWorkKinds(workKinds) {
    this.setState({workKindsList: workKinds.result});
  }

  handleGetOrganizations(organizations) {
    this.setState({organizations: organizations.result});
  }

  handleGetFaxogramms(faxogramms) {
    this.setState({faxogrammsList: faxogramms.result, faxogrammsMaxPage: faxogramms.total_pages});
  }

  handleGetPositions(positions) {
    this.setState({positionsList: positions.result});
  }

  getWorkKindById(id) {
    return _.find(this.state.workKindsList, wk =&gt; wk.id === id) || {};
  }

  getTechOperationById(id) {
    return _.find(this.state.technicalOperationsList, to =&gt; to.id === id) || {};
  }

  getCarById(asuods_id) {
    return _.find(this.state.carsList, c =&gt; c.asuods_id === asuods_id) || {};
  }

  getModelById(id) {
    return _.find(this.state.modelsList, c =&gt; c.id === id) || {};
  }

  getTypeById(id) {
    return _.find(this.state.typesList, t =&gt; t.id === id) || {};
  }

}

export default ObjectsStore;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
